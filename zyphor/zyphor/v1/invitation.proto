edition = "2023";

package zyphor.v1;

import "buf/validate/validate.proto";
import "google/api/annotations.proto";
import "google/protobuf/duration.proto";
import "zyphor/v1/options.proto";

service InvitationService {
  rpc GetInvitation(GetInvitationRequest) returns (GetInvitationResponse) {
    option (google.api.http) = {get: "/v1/invite/{token}"};
  }
  rpc CreateInvitation(CreateInvitationRequest) returns (CreateInvitationResponse) {
    option (google.api.http) = {post: "/v1/invite/{workspace_id}/{expiry}"};
  }
  rpc AcceptInvitation(AcceptInvitationRequest) returns (AcceptInvitationResponse) {
    option (google.api.http) = {post: "/v1/invite/claim/{token}"};
  }
}

message GetInvitationRequest {
  string token = 1 [
    (buf.validate.field).string.min_len = 1,
    (zyphor.v1.sensitive) = true
  ];
}
message GetInvitationResponse {
  string invited_by = 1;
  string workspace_name = 2;
}

message CreateInvitationRequest {
  string workspace_id = 1 [(buf.validate.field).string.uuid = true];
  google.protobuf.Duration expiry = 2 [(buf.validate.field).duration = {
    gte: {seconds: 300} /* Min 5 minutes */
    lte: {seconds: 2592000} /* Max 30 days */
  }];
}
message CreateInvitationResponse {
  string link = 1 [(zyphor.v1.sensitive) = true];
}

message AcceptInvitationRequest {
  string token = 1 [
    (buf.validate.field).string.min_len = 1,
    (zyphor.v1.sensitive) = true
  ];
}
message AcceptInvitationResponse {
  string workspace_id = 1;
}
